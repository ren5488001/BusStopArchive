<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.system.mapper.BamsStageTemplateMapper">

    <resultMap type="BamsStageTemplate" id="BamsStageTemplateResult">
        <result property="templateId"     column="template_id"     />
        <result property="templateName"   column="template_name"   />
        <result property="templateDesc"   column="template_desc"   />
        <result property="stageCount"     column="stage_count"     />
        <result property="status"         column="status"          />
        <result property="delFlag"        column="del_flag"        />
        <result property="createBy"       column="create_by"       />
        <result property="createTime"     column="create_time"     />
        <result property="updateBy"       column="update_by"       />
        <result property="updateTime"     column="update_time"     />
        <result property="remark"         column="remark"          />
    </resultMap>

    <resultMap type="BamsStageTemplate" id="BamsStageTemplateDetailResult" extends="BamsStageTemplateResult">
        <collection property="stages" ofType="BamsStageTemplateDetail" column="template_id" select="com.ruoyi.system.mapper.BamsStageTemplateDetailMapper.selectDetailListByTemplateId"/>
    </resultMap>

    <sql id="selectTemplateVo">
        select template_id, template_name, template_desc, stage_count, status, del_flag,
               create_by, create_time, update_by, update_time, remark
        from bams_stage_template
    </sql>

    <select id="selectTemplateById" parameterType="Long" resultMap="BamsStageTemplateDetailResult">
        <include refid="selectTemplateVo"/>
        where template_id = #{templateId} and del_flag = '0'
    </select>

    <select id="selectTemplateList" parameterType="BamsStageTemplate" resultMap="BamsStageTemplateResult">
        <include refid="selectTemplateVo"/>
        <where>
            del_flag = '0'
            <if test="templateName != null and templateName != ''">
                AND template_name like concat('%', #{templateName}, '%')
            </if>
            <if test="status != null and status != ''">
                AND status = #{status}
            </if>
        </where>
        order by create_time desc
    </select>

    <insert id="insertTemplate" parameterType="BamsStageTemplate" useGeneratedKeys="true" keyProperty="templateId">
        insert into bams_stage_template (
            <if test="templateName != null and templateName != ''">template_name, </if>
            <if test="templateDesc != null and templateDesc != ''">template_desc, </if>
            <if test="stageCount != null">stage_count, </if>
            <if test="status != null and status != ''">status, </if>
            <if test="delFlag != null and delFlag != ''">del_flag, </if>
            <if test="remark != null and remark != ''">remark, </if>
            <if test="createBy != null and createBy != ''">create_by, </if>
            create_time
        )values(
            <if test="templateName != null and templateName != ''">#{templateName}, </if>
            <if test="templateDesc != null and templateDesc != ''">#{templateDesc}, </if>
            <if test="stageCount != null">#{stageCount}, </if>
            <if test="status != null and status != ''">#{status}, </if>
            <if test="delFlag != null and delFlag != ''">#{delFlag}, </if>
            <if test="remark != null and remark != ''">#{remark}, </if>
            <if test="createBy != null and createBy != ''">#{createBy}, </if>
            sysdate()
        )
    </insert>

    <update id="updateTemplate" parameterType="BamsStageTemplate">
        update bams_stage_template
        <set>
            <if test="templateName != null and templateName != ''">template_name = #{templateName}, </if>
            <if test="templateDesc != null">template_desc = #{templateDesc}, </if>
            <if test="stageCount != null">stage_count = #{stageCount}, </if>
            <if test="status != null and status != ''">status = #{status}, </if>
            <if test="remark != null">remark = #{remark}, </if>
            <if test="updateBy != null and updateBy != ''">update_by = #{updateBy}, </if>
            update_time = sysdate()
        </set>
        where template_id = #{templateId}
    </update>

    <delete id="deleteTemplateById" parameterType="Long">
        update bams_stage_template set del_flag = '2' where template_id = #{templateId}
    </delete>

    <delete id="deleteTemplateByIds" parameterType="Long">
        update bams_stage_template set del_flag = '2' where template_id in
        <foreach item="templateId" collection="array" open="(" separator="," close=")">
            #{templateId}
        </foreach>
    </delete>

</mapper>
